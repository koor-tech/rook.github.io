<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Rook Ceph Documentation"><meta name=author content="Rook Authors"><link href=https://rook.io/latest/CRDs/ceph-nfs-crd/ rel=canonical><link rel=icon href=https://rook.io/images/favicon_192x192.png><meta name=generator content="mkdocs-1.3.0, mkdocs-material-8.2.15"><title>NFS Server CRD - Rook Ceph Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.c382b1dc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cc9b2e1e.min.css><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=rook-blue data-md-color-accent=deep-orange> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#overview class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> This document is for a development version of Rook. <a href=../../..> <strong>Click here to go to latest release documentation.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Rook Ceph Documentation" class="md-header__button md-logo" aria-label="Rook Ceph Documentation" data-md-component=logo> <img src=https://rook.io/images/rook-logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Rook Ceph Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> NFS Server CRD </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=rook-blue data-md-color-accent=deep-orange aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=rook-blue data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/rook/rook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../Getting-Started/intro/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../Helm-Charts/helm-charts/ class=md-tabs__link> Helm Charts </a> </li> <li class=md-tabs__item> <a href=../../Storage-Configuration/Block-Storage-RBD/block-storage/ class=md-tabs__link> Storage Configuration </a> </li> <li class=md-tabs__item> <a href=../ceph-cluster-crd/ class="md-tabs__link md-tabs__link--active"> Custom Resources </a> </li> <li class=md-tabs__item> <a href=../../Troubleshooting/ceph-toolbox/ class=md-tabs__link> Troubleshooting </a> </li> <li class=md-tabs__item> <a href=../../Upgrade/rook-upgrade/ class=md-tabs__link> Upgrade </a> </li> <li class=md-tabs__item> <a href=../../Contributing/development-flow/ class=md-tabs__link> Contributing </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Rook Ceph Documentation" class="md-nav__button md-logo" aria-label="Rook Ceph Documentation" data-md-component=logo> <img src=https://rook.io/images/rook-logo.svg alt=logo> </a> Rook Ceph Documentation </label> <div class=md-nav__source> <a href=https://github.com/rook/rook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 data-md-state=indeterminate type=checkbox id=__nav_1 checked> <label class=md-nav__link for=__nav_1> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Getting-Started/intro/ class=md-nav__link> Rook </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_2 data-md-state=indeterminate type=checkbox id=__nav_1_2 checked> <label class=md-nav__link for=__nav_1_2> Prerequisites <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Prerequisites data-md-level=2> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Prerequisites </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Getting-Started/Prerequisites/prerequisites/ class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=../../Getting-Started/Prerequisites/authenticated-registry/ class=md-nav__link> Authenticated Container Registries </a> </li> <li class=md-nav__item> <a href=../../Getting-Started/Prerequisites/pod-security-policies/ class=md-nav__link> Pod Security Policies </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../Getting-Started/quickstart/ class=md-nav__link> Quickstart </a> </li> <li class=md-nav__item> <a href=../../Getting-Started/storage-architecture/ class=md-nav__link> Storage Architecture </a> </li> <li class=md-nav__item> <a href=../../Getting-Started/example-configurations/ class=md-nav__link> Example Configurations </a> </li> <li class=md-nav__item> <a href=../../Getting-Started/ceph-openshift/ class=md-nav__link> OpenShift </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 data-md-state=indeterminate type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Helm Charts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Helm Charts" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Helm Charts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Helm-Charts/helm-charts/ class=md-nav__link> Helm Charts Overview </a> </li> <li class=md-nav__item> <a href=../../Helm-Charts/operator-chart/ class=md-nav__link> Ceph Operator Helm Chart </a> </li> <li class=md-nav__item> <a href=../../Helm-Charts/ceph-cluster-chart/ class=md-nav__link> Ceph Cluster Helm Chart </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 data-md-state=indeterminate type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Storage Configuration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Storage Configuration" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Storage Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1 data-md-state=indeterminate type=checkbox id=__nav_3_1 checked> <label class=md-nav__link for=__nav_3_1> Block Storage (RBD) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Block Storage (RBD)" data-md-level=2> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Block Storage (RBD) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Storage-Configuration/Block-Storage-RBD/block-storage/ class=md-nav__link> Block Storage Overview </a> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/Block-Storage-RBD/rbd-mirroring/ class=md-nav__link> RBD Mirroring </a> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/Block-Storage-RBD/rbd-async-disaster-recovery-failover-failback/ class=md-nav__link> RBD Asynchronous DR Failover and Failback </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 data-md-state=indeterminate type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2> Shared Filesystem (CephFS) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Shared Filesystem (CephFS)" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Shared Filesystem (CephFS) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Storage-Configuration/Shared-Filesystem-CephFS/filesystem-storage/ class=md-nav__link> Filesystem Storage Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 data-md-state=indeterminate type=checkbox id=__nav_3_3 checked> <label class=md-nav__link for=__nav_3_3> Object Storage (RGW) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Object Storage (RGW)" data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Object Storage (RGW) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Storage-Configuration/Object-Storage-RGW/object-storage/ class=md-nav__link> Object Storage Overview </a> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/Object-Storage-RGW/ceph-object-bucket-claim/ class=md-nav__link> Bucket Claim </a> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/Object-Storage-RGW/ceph-object-bucket-notifications/ class=md-nav__link> Object Bucket Notifications </a> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/Object-Storage-RGW/ceph-object-multisite/ class=md-nav__link> Object Store Multisite </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 data-md-state=indeterminate type=checkbox id=__nav_3_4 checked> <label class=md-nav__link for=__nav_3_4> Monitoring <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Monitoring data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Storage-Configuration/Monitoring/ceph-dashboard/ class=md-nav__link> Ceph Dashboard </a> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/Monitoring/ceph-monitoring/ class=md-nav__link> Prometheus Monitoring </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 data-md-state=indeterminate type=checkbox id=__nav_3_5 checked> <label class=md-nav__link for=__nav_3_5> Ceph CSI <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ceph CSI" data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Ceph CSI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Storage-Configuration/Ceph-CSI/ceph-csi-drivers/ class=md-nav__link> Ceph CSI Drivers </a> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/Ceph-CSI/ceph-csi-snapshot/ class=md-nav__link> Snapshots </a> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/Ceph-CSI/ceph-csi-volume-clone/ class=md-nav__link> Volume clone </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/ceph-teardown/ class=md-nav__link> Cleanup </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7 data-md-state=indeterminate type=checkbox id=__nav_3_7 checked> <label class=md-nav__link for=__nav_3_7> Advanced <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Advanced data-md-level=2> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Storage-Configuration/Advanced/ceph-configuration/ class=md-nav__link> Ceph Configuration </a> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/Advanced/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/Advanced/key-management-system/ class=md-nav__link> Key Management System </a> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/Advanced/ceph-osd-mgmt/ class=md-nav__link> Ceph OSD Management </a> </li> <li class=md-nav__item> <a href=../../Storage-Configuration/Advanced/ceph-mon-health/ class=md-nav__link> Monitor Health </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Custom Resources <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Custom Resources" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Custom Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ceph-cluster-crd/ class=md-nav__link> Cluster CRD </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 data-md-state=indeterminate type=checkbox id=__nav_4_2 checked> <label class=md-nav__link for=__nav_4_2> Block Storage <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Block Storage" data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Block Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Block-Storage/ceph-block-pool-crd/ class=md-nav__link> Block Pool CRD </a> </li> <li class=md-nav__item> <a href=../Block-Storage/ceph-block-pool-rados-namespace-crd/ class=md-nav__link> Block Pool RADOS Namespace CRD </a> </li> <li class=md-nav__item> <a href=../Block-Storage/ceph-rbd-mirror-crd/ class=md-nav__link> RBD Mirror CRD </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 data-md-state=indeterminate type=checkbox id=__nav_4_3 checked> <label class=md-nav__link for=__nav_4_3> Shared Filesystem <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Shared Filesystem" data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Shared Filesystem </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Shared-Filesystem/ceph-filesystem-crd/ class=md-nav__link> Filesystem CRD </a> </li> <li class=md-nav__item> <a href=../Shared-Filesystem/ceph-fs-mirror-crd/ class=md-nav__link> Filesystem Mirror CRD </a> </li> <li class=md-nav__item> <a href=../Shared-Filesystem/ceph-fs-subvolumegroup-crd/ class=md-nav__link> Filesystem SubVolume Group CRD </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4 data-md-state=indeterminate type=checkbox id=__nav_4_4 checked> <label class=md-nav__link for=__nav_4_4> Object Storage <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Object Storage" data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Object Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Object-Storage/ceph-object-store-crd/ class=md-nav__link> Object Store CRD </a> </li> <li class=md-nav__item> <a href=../Object-Storage/ceph-object-store-user-crd/ class=md-nav__link> Object Store User CRD </a> </li> <li class=md-nav__item> <a href=../Object-Storage/ceph-object-multisite-crd/ class=md-nav__link> Object Multisite CRDs </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ceph-client-crd/ class=md-nav__link> Client CRD </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> NFS Server CRD <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> NFS Server CRD </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#examples class=md-nav__link> Examples </a> </li> <li class=md-nav__item> <a href=#nfs-settings class=md-nav__link> NFS Settings </a> <nav class=md-nav aria-label="NFS Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#server class=md-nav__link> Server </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#creating-exports class=md-nav__link> Creating Exports </a> <nav class=md-nav aria-label="Creating Exports"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#using-the-ceph-dashboard class=md-nav__link> Using the Ceph Dashboard </a> </li> <li class=md-nav__item> <a href=#using-the-ceph-cli class=md-nav__link> Using the Ceph CLI </a> <nav class=md-nav aria-label="Using the Ceph CLI"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enable-the-ceph-orchestrator-if-necessary class=md-nav__link> Enable the Ceph orchestrator if necessary </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mounting-exports class=md-nav__link> Mounting exports </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#exposing-the-nfs-server-outside-of-the-kubernetes-cluster class=md-nav__link> Exposing the NFS server outside of the Kubernetes cluster </a> </li> <li class=md-nav__item> <a href=#scaling-the-active-server-count class=md-nav__link> Scaling the active server count </a> </li> <li class=md-nav__item> <a href=#known-issues class=md-nav__link> Known issues </a> <nav class=md-nav aria-label="Known issues"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#serveractive-count-greater-than-1 class=md-nav__link> server.active count greater than 1 </a> </li> <li class=md-nav__item> <a href=#ceph-v1720 class=md-nav__link> Ceph v17.2.0 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-configuration class=md-nav__link> Advanced configuration </a> <nav class=md-nav aria-label="Advanced configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#changing-configuration-of-the-nfs-pool class=md-nav__link> Changing configuration of the .nfs pool </a> </li> <li class=md-nav__item> <a href=#adding-custom-nfs-ganesha-config-file-changes class=md-nav__link> Adding custom NFS-Ganesha config file changes </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ceph-csi-nfs-provisioner-and-nfs-csi-driver class=md-nav__link> Ceph CSI NFS provisioner and NFS CSI driver </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 data-md-state=indeterminate type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> Troubleshooting <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Troubleshooting data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Troubleshooting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Troubleshooting/ceph-toolbox/ class=md-nav__link> Toolbox </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/common-issues/ class=md-nav__link> Common Issues </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/ceph-common-issues/ class=md-nav__link> Ceph Common Issues </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/ceph-csi-common-issues/ class=md-nav__link> CSI Common Issues </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/openshift-common-issues/ class=md-nav__link> OpenShift Common Issues </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/disaster-recovery/ class=md-nav__link> Disaster Recovery </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/direct-tools/ class=md-nav__link> Direct Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 data-md-state=indeterminate type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6> Upgrade <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Upgrade data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Upgrade </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Upgrade/rook-upgrade/ class=md-nav__link> Rook Upgrades </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 data-md-state=indeterminate type=checkbox id=__nav_7 checked> <label class=md-nav__link for=__nav_7> Contributing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Contributing data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Contributing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Contributing/development-flow/ class=md-nav__link> Development Flow </a> </li> <li class=md-nav__item> <a href=../../Contributing/development-environment/ class=md-nav__link> Developer Environment </a> </li> <li class=md-nav__item> <a href=../../Contributing/documentation/ class=md-nav__link> Documentation </a> </li> <li class=md-nav__item> <a href=../../Contributing/storage-providers/ class=md-nav__link> Storage Providers </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#examples class=md-nav__link> Examples </a> </li> <li class=md-nav__item> <a href=#nfs-settings class=md-nav__link> NFS Settings </a> <nav class=md-nav aria-label="NFS Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#server class=md-nav__link> Server </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#creating-exports class=md-nav__link> Creating Exports </a> <nav class=md-nav aria-label="Creating Exports"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#using-the-ceph-dashboard class=md-nav__link> Using the Ceph Dashboard </a> </li> <li class=md-nav__item> <a href=#using-the-ceph-cli class=md-nav__link> Using the Ceph CLI </a> <nav class=md-nav aria-label="Using the Ceph CLI"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enable-the-ceph-orchestrator-if-necessary class=md-nav__link> Enable the Ceph orchestrator if necessary </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mounting-exports class=md-nav__link> Mounting exports </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#exposing-the-nfs-server-outside-of-the-kubernetes-cluster class=md-nav__link> Exposing the NFS server outside of the Kubernetes cluster </a> </li> <li class=md-nav__item> <a href=#scaling-the-active-server-count class=md-nav__link> Scaling the active server count </a> </li> <li class=md-nav__item> <a href=#known-issues class=md-nav__link> Known issues </a> <nav class=md-nav aria-label="Known issues"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#serveractive-count-greater-than-1 class=md-nav__link> server.active count greater than 1 </a> </li> <li class=md-nav__item> <a href=#ceph-v1720 class=md-nav__link> Ceph v17.2.0 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-configuration class=md-nav__link> Advanced configuration </a> <nav class=md-nav aria-label="Advanced configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#changing-configuration-of-the-nfs-pool class=md-nav__link> Changing configuration of the .nfs pool </a> </li> <li class=md-nav__item> <a href=#adding-custom-nfs-ganesha-config-file-changes class=md-nav__link> Adding custom NFS-Ganesha config file changes </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ceph-csi-nfs-provisioner-and-nfs-csi-driver class=md-nav__link> Ceph CSI NFS provisioner and NFS CSI driver </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/rook/rook/edit/master/Documentation/CRDs/ceph-nfs-crd.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>NFS Server CRD</h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>Rook allows exporting NFS shares of a CephFilesystem or CephObjectStore through the CephNFS custom resource definition. This will spin up a cluster of <a href=https://github.com/nfs-ganesha/nfs-ganesha>NFS Ganesha</a> servers that coordinate with one another via shared RADOS objects. The servers will be configured for NFSv4.1+ access only, as serving earlier protocols can inhibit responsiveness after a server restart.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Due to a number of Ceph issues and changes, Rook officially only supports Ceph v16.2.7 or higher for CephNFS. If you are using an earlier version, upgrade your Ceph version following the advice given in Rook's <a href=https://rook.github.io/docs/rook/v1.9/ceph-nfs-crd.html>v1.9 NFS docs</a>.</p> </div> <h2 id=examples>Examples<a class=headerlink href=#examples title="Permanent link">&para;</a></h2> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1> 1</a></span>
<span class=normal><a href=#__codelineno-0-2> 2</a></span>
<span class=normal><a href=#__codelineno-0-3> 3</a></span>
<span class=normal><a href=#__codelineno-0-4> 4</a></span>
<span class=normal><a href=#__codelineno-0-5> 5</a></span>
<span class=normal><a href=#__codelineno-0-6> 6</a></span>
<span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph.rook.io/v1</span><span class=w></span>
<a id=__codelineno-0-2 name=__codelineno-0-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CephNFS</span><span class=w></span>
<a id=__codelineno-0-3 name=__codelineno-0-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-4 name=__codelineno-0-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-nfs</span><span class=w></span>
<a id=__codelineno-0-5 name=__codelineno-0-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span><span class=w></span>
<a id=__codelineno-0-6 name=__codelineno-0-6></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>  </span><span class=c1># Settings for the NFS server</span><span class=w></span>
<a id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>  </span><span class=nt>server</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=w>    </span><span class=nt>active</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>
<a id=__codelineno-0-10 name=__codelineno-0-10></a>
<a id=__codelineno-0-11 name=__codelineno-0-11></a><span class=w>    </span><span class=nt>placement</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=w>      </span><span class=nt>nodeAffinity</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=w>        </span><span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>          </span><span class=nt>nodeSelectorTerms</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matchExpressions</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-16 name=__codelineno-0-16></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">role</span><span class=w></span>
<a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=w>              </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">In</span><span class=w></span>
<a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=w>              </span><span class=nt>values</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nfs-node</span><span class=w></span>
<a id=__codelineno-0-20 name=__codelineno-0-20></a><span class=w>      </span><span class=nt>topologySpreadConstraints</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-21 name=__codelineno-0-21></a><span class=w>      </span><span class=nt>tolerations</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-22 name=__codelineno-0-22></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nfs-node</span><span class=w></span>
<a id=__codelineno-0-23 name=__codelineno-0-23></a><span class=w>        </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Exists</span><span class=w></span>
<a id=__codelineno-0-24 name=__codelineno-0-24></a><span class=w>      </span><span class=nt>podAffinity</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-25 name=__codelineno-0-25></a><span class=w>      </span><span class=nt>podAntiAffinity</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-26 name=__codelineno-0-26></a>
<a id=__codelineno-0-27 name=__codelineno-0-27></a><span class=w>    </span><span class=nt>annotations</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-28 name=__codelineno-0-28></a><span class=w>      </span><span class=nt>my-annotation</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">something</span><span class=w></span>
<a id=__codelineno-0-29 name=__codelineno-0-29></a>
<a id=__codelineno-0-30 name=__codelineno-0-30></a><span class=w>    </span><span class=nt>labels</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-31 name=__codelineno-0-31></a><span class=w>      </span><span class=nt>my-label</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">something</span><span class=w></span>
<a id=__codelineno-0-32 name=__codelineno-0-32></a>
<a id=__codelineno-0-33 name=__codelineno-0-33></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-34 name=__codelineno-0-34></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-35 name=__codelineno-0-35></a><span class=w>        </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;500m&quot;</span><span class=w></span>
<a id=__codelineno-0-36 name=__codelineno-0-36></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1024Mi&quot;</span><span class=w></span>
<a id=__codelineno-0-37 name=__codelineno-0-37></a><span class=w>      </span><span class=nt>requests</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-38 name=__codelineno-0-38></a><span class=w>        </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;500m&quot;</span><span class=w></span>
<a id=__codelineno-0-39 name=__codelineno-0-39></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1024Mi&quot;</span><span class=w></span>
<a id=__codelineno-0-40 name=__codelineno-0-40></a>
<a id=__codelineno-0-41 name=__codelineno-0-41></a><span class=w>    </span><span class=nt>priorityClassName</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-42 name=__codelineno-0-42></a>
<a id=__codelineno-0-43 name=__codelineno-0-43></a><span class=w>    </span><span class=nt>logLevel</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NIV_INFO</span><span class=w></span>
</code></pre></div></td></tr></table></div> <h2 id=nfs-settings>NFS Settings<a class=headerlink href=#nfs-settings title="Permanent link">&para;</a></h2> <h3 id=server>Server<a class=headerlink href=#server title="Permanent link">&para;</a></h3> <p>The <code>server</code> spec sets configuration for Rook-created NFS-Ganesha servers.</p> <ul> <li><code>active</code>: The number of active NFS servers. Rook supports creating more than one active NFS server, but cannot guarantee high availability. For values greater than 1, see the <a href=#serveractive-count-greater-than-1>known issue</a> below.</li> <li><code>placement</code>: Kubernetes placement restrictions to apply to NFS server Pod(s). This is similar to placement defined for daemons configured by the <a href=https://github.com/rook/rook/blob/master/deploy/examples/cluster.yaml>CephCluster CRD</a>.</li> <li><code>annotations</code>: Kubernetes annotations to apply to NFS server Pod(s)</li> <li><code>labels</code>: Kubernetes labels to apply to NFS server Pod(s)</li> <li><code>resources</code>: Kubernetes resource requests and limits to set on NFS server Pod(s)</li> <li><code>priorityClassName</code>: Set priority class name for the NFS server Pod(s)</li> <li><code>logLevel</code>: The log level that NFS-Ganesha servers should output. Default value: NIV_INFO Supported values: NIV_NULL | NIV_FATAL | NIV_MAJ | NIV_CRIT | NIV_WARN | NIV_EVENT | NIV_INFO | NIV_DEBUG | NIV_MID_DEBUG | NIV_FULL_DEBUG | NB_LOG_LEVEL</li> </ul> <h2 id=creating-exports>Creating Exports<a class=headerlink href=#creating-exports title="Permanent link">&para;</a></h2> <p>When a CephNFS is first created, all NFS daemons within the CephNFS cluster will share a configuration with no exports defined.</p> <h3 id=using-the-ceph-dashboard>Using the Ceph Dashboard<a class=headerlink href=#using-the-ceph-dashboard title="Permanent link">&para;</a></h3> <p>Exports can be created via the <a href=https://docs.ceph.com/en/latest/mgr/dashboard/#nfs-ganesha-management>Ceph dashboard</a> for Ceph v16 as well. To enable and use the Ceph dashboard in Rook, see <a href=../../Storage-Configuration/Monitoring/ceph-dashboard/ >here</a>.</p> <h3 id=using-the-ceph-cli>Using the Ceph CLI<a class=headerlink href=#using-the-ceph-cli title="Permanent link">&para;</a></h3> <p>The Ceph CLI can be used from the Rook toolbox pod to create and manage NFS exports. To do so, first ensure the necessary Ceph mgr modules are enabled, if necessary, and that the Ceph orchestrator backend is set to Rook.</p> <h4 id=enable-the-ceph-orchestrator-if-necessary><strong>Enable the Ceph orchestrator if necessary</strong><a class=headerlink href=#enable-the-ceph-orchestrator-if-necessary title="Permanent link">&para;</a></h4> <ul> <li>Required for Ceph v16.2.7 and below</li> <li>Optional for Ceph v16.2.8 and above</li> <li>Must be disabled for Ceph v17.2.0 due to a <a href=#ceph-v1720>Ceph regression</a></li> </ul> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-1>1</a></span>
<span class=normal><a href=#__codelineno-1-2>2</a></span>
<span class=normal><a href=#__codelineno-1-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1></a><span class=go>ceph mgr module enable rook</span>
<a id=__codelineno-1-2 name=__codelineno-1-2></a><span class=go>ceph mgr module enable nfs</span>
<a id=__codelineno-1-3 name=__codelineno-1-3></a><span class=go>ceph orch set backend rook</span>
</code></pre></div></td></tr></table></div> <p><a href=https://docs.ceph.com/en/latest/mgr/nfs/#export-management>Ceph's NFS CLI</a> can create NFS exports that are backed by <a href=https://docs.ceph.com/en/latest/cephfs/nfs/ >CephFS</a> (a CephFilesystem) or <a href=https://docs.ceph.com/en/latest/radosgw/nfs/ >Ceph Object Gateway</a> (a CephObjectStore). <code>cluster_id</code> or <code>cluster-name</code> in the Ceph NFS docs normally refers to the name of the NFS cluster, which is the CephNFS name in the Rook context.</p> <p>For creating an NFS export for the CephNFS and CephFilesystem example manifests, the below command can be used. This creates an export for the <code>/test</code> pseudo path.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1></a><span class=go>ceph nfs export create cephfs my-nfs /test myfs</span>
</code></pre></div></td></tr></table></div> <p>The below command will list the current NFS exports for the example CephNFS cluster, which will give the output shown for the current example.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1>1</a></span>
<span class=normal><a href=#__codelineno-3-2>2</a></span>
<span class=normal><a href=#__codelineno-3-3>3</a></span>
<span class=normal><a href=#__codelineno-3-4>4</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1></a><span class=gp>$ </span>ceph nfs <span class=nb>export</span> ls my-nfs
<a id=__codelineno-3-2 name=__codelineno-3-2></a><span class=go>[</span>
<a id=__codelineno-3-3 name=__codelineno-3-3></a><span class=go>  &quot;/test&quot;</span>
<a id=__codelineno-3-4 name=__codelineno-3-4></a><span class=go>]</span>
</code></pre></div></td></tr></table></div> <p>The simple <code>/test</code> export's info can be listed as well. Notice from the example that only NFS protocol v4 via TCP is supported.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1> 1</a></span>
<span class=normal><a href=#__codelineno-4-2> 2</a></span>
<span class=normal><a href=#__codelineno-4-3> 3</a></span>
<span class=normal><a href=#__codelineno-4-4> 4</a></span>
<span class=normal><a href=#__codelineno-4-5> 5</a></span>
<span class=normal><a href=#__codelineno-4-6> 6</a></span>
<span class=normal><a href=#__codelineno-4-7> 7</a></span>
<span class=normal><a href=#__codelineno-4-8> 8</a></span>
<span class=normal><a href=#__codelineno-4-9> 9</a></span>
<span class=normal><a href=#__codelineno-4-10>10</a></span>
<span class=normal><a href=#__codelineno-4-11>11</a></span>
<span class=normal><a href=#__codelineno-4-12>12</a></span>
<span class=normal><a href=#__codelineno-4-13>13</a></span>
<span class=normal><a href=#__codelineno-4-14>14</a></span>
<span class=normal><a href=#__codelineno-4-15>15</a></span>
<span class=normal><a href=#__codelineno-4-16>16</a></span>
<span class=normal><a href=#__codelineno-4-17>17</a></span>
<span class=normal><a href=#__codelineno-4-18>18</a></span>
<span class=normal><a href=#__codelineno-4-19>19</a></span>
<span class=normal><a href=#__codelineno-4-20>20</a></span>
<span class=normal><a href=#__codelineno-4-21>21</a></span>
<span class=normal><a href=#__codelineno-4-22>22</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1></a><span class=gp>$ </span>ceph nfs <span class=nb>export</span> info my-nfs /test
<a id=__codelineno-4-2 name=__codelineno-4-2></a><span class=go>{</span>
<a id=__codelineno-4-3 name=__codelineno-4-3></a><span class=go>  &quot;export_id&quot;: 1,</span>
<a id=__codelineno-4-4 name=__codelineno-4-4></a><span class=go>  &quot;path&quot;: &quot;/&quot;,</span>
<a id=__codelineno-4-5 name=__codelineno-4-5></a><span class=go>  &quot;cluster_id&quot;: &quot;my-nfs&quot;,</span>
<a id=__codelineno-4-6 name=__codelineno-4-6></a><span class=go>  &quot;pseudo&quot;: &quot;/test&quot;,</span>
<a id=__codelineno-4-7 name=__codelineno-4-7></a><span class=go>  &quot;access_type&quot;: &quot;RW&quot;,</span>
<a id=__codelineno-4-8 name=__codelineno-4-8></a><span class=go>  &quot;squash&quot;: &quot;none&quot;,</span>
<a id=__codelineno-4-9 name=__codelineno-4-9></a><span class=go>  &quot;security_label&quot;: true,</span>
<a id=__codelineno-4-10 name=__codelineno-4-10></a><span class=go>  &quot;protocols&quot;: [</span>
<a id=__codelineno-4-11 name=__codelineno-4-11></a><span class=go>    4</span>
<a id=__codelineno-4-12 name=__codelineno-4-12></a><span class=go>  ],</span>
<a id=__codelineno-4-13 name=__codelineno-4-13></a><span class=go>  &quot;transports&quot;: [</span>
<a id=__codelineno-4-14 name=__codelineno-4-14></a><span class=go>    &quot;TCP&quot;</span>
<a id=__codelineno-4-15 name=__codelineno-4-15></a><span class=go>  ],</span>
<a id=__codelineno-4-16 name=__codelineno-4-16></a><span class=go>  &quot;fsal&quot;: {</span>
<a id=__codelineno-4-17 name=__codelineno-4-17></a><span class=go>    &quot;name&quot;: &quot;CEPH&quot;,</span>
<a id=__codelineno-4-18 name=__codelineno-4-18></a><span class=go>    &quot;user_id&quot;: &quot;nfs.my-nfs.1&quot;,</span>
<a id=__codelineno-4-19 name=__codelineno-4-19></a><span class=go>    &quot;fs_name&quot;: &quot;myfs&quot;</span>
<a id=__codelineno-4-20 name=__codelineno-4-20></a><span class=go>  },</span>
<a id=__codelineno-4-21 name=__codelineno-4-21></a><span class=go>  &quot;clients&quot;: []</span>
<a id=__codelineno-4-22 name=__codelineno-4-22></a><span class=go>}</span>
</code></pre></div></td></tr></table></div> <p>If you are done managing NFS exports and don't need the Ceph orchestrator module enabled for anything else, it may be preferable to disable the Rook and NFS mgr modules to free up a small amount of RAM in the Ceph mgr Pod.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-5-1>1</a></span>
<span class=normal><a href=#__codelineno-5-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1></a><span class=go>ceph orch set backend &quot;&quot;</span>
<a id=__codelineno-5-2 name=__codelineno-5-2></a><span class=go>ceph mgr module disable rook</span>
</code></pre></div></td></tr></table></div> <h3 id=mounting-exports>Mounting exports<a class=headerlink href=#mounting-exports title="Permanent link">&para;</a></h3> <p>Each CephNFS server has a unique Kubernetes Service. This is because NFS clients can't readily handle NFS failover. CephNFS services are named with the pattern <code>rook-ceph-nfs-&lt;cephnfs-name&gt;-&lt;id&gt;</code> <code>&lt;id&gt;</code> is a unique letter ID (e.g., a, b, c, etc.) for a given NFS server. For example, <code>rook-ceph-nfs-my-nfs-a</code>.</p> <p>For each NFS client, choose an NFS service to use for the connection. With NFS v4, you can mount an export by its path using a mount command like below. You can mount all exports at once by omitting the export path and leaving the directory as just <code>/</code>.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-6-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1></a><span class=go>mount -t nfs4 -o proto=tcp &lt;nfs-service-address&gt;:/&lt;export-path&gt; &lt;mount-location&gt;</span>
</code></pre></div></td></tr></table></div> <h2 id=exposing-the-nfs-server-outside-of-the-kubernetes-cluster>Exposing the NFS server outside of the Kubernetes cluster<a class=headerlink href=#exposing-the-nfs-server-outside-of-the-kubernetes-cluster title="Permanent link">&para;</a></h2> <p>Use a LoadBalancer Service to expose an NFS server (and its exports) outside of the Kubernetes cluster. The Service's endpoint can be used as the NFS service address when <a href=#mounting-exports>mounting the export manually</a>. We provide an example Service here: <a href=https://github.com/rook/rook/tree/master/deploy/examples><code>deploy/examples/nfs-load-balancer.yaml</code></a>.</p> <h2 id=scaling-the-active-server-count>Scaling the active server count<a class=headerlink href=#scaling-the-active-server-count title="Permanent link">&para;</a></h2> <p>It is possible to scale the size of the cluster up or down by modifying the <code>spec.server.active</code> field. Scaling the cluster size up can be done at will. Once the new server comes up, clients can be assigned to it immediately.</p> <p>The CRD always eliminates the highest index servers first, in reverse order from how they were started. Scaling down the cluster requires that clients be migrated from servers that will be eliminated to others. That process is currently a manual one and should be performed before reducing the size of the cluster.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>See the <a href=#serveractive-count-greater-than-1>known issue</a> below about setting this value greater than one.</p> </div> <h2 id=known-issues>Known issues<a class=headerlink href=#known-issues title="Permanent link">&para;</a></h2> <h3 id=serveractive-count-greater-than-1>server.active count greater than 1<a class=headerlink href=#serveractive-count-greater-than-1 title="Permanent link">&para;</a></h3> <ul> <li>Active-active scale out does not work well with the NFS protocol. If one NFS server in a cluster is offline, other servers may block client requests until the offline server returns, which may not always happen due to the Kubernetes scheduler.</li> <li>Workaround: It is safest to run only a single NFS server, but we do not limit this if it benefits your use case.</li> </ul> <h3 id=ceph-v1720>Ceph v17.2.0<a class=headerlink href=#ceph-v1720 title="Permanent link">&para;</a></h3> <ul> <li>Ceph NFS management with the Rook mgr module enabled has a breaking regression with the Ceph Quincy v17.2.0 release.</li> <li> <p>Workaround: Leave Ceph's Rook orchestrator mgr module disabled. If you have enabled it, you must disable it using the snippet below from the toolbox.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-7-1>1</a></span>
<span class=normal><a href=#__codelineno-7-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1></a><span class=go>ceph orch set backend &quot;&quot;</span>
<a id=__codelineno-7-2 name=__codelineno-7-2></a><span class=go>ceph mgr module disable rook</span>
</code></pre></div></td></tr></table></div> </li> </ul> <h2 id=advanced-configuration>Advanced configuration<a class=headerlink href=#advanced-configuration title="Permanent link">&para;</a></h2> <p>All CephNFS daemons are configured using shared RADOS objects stored in a Ceph pool named <code>.nfs</code>. Users can modify the configuration object for each CephNFS cluster if they wish to customize the configuration.</p> <h3 id=changing-configuration-of-the-nfs-pool>Changing configuration of the .nfs pool<a class=headerlink href=#changing-configuration-of-the-nfs-pool title="Permanent link">&para;</a></h3> <p>By default, Rook creates the <code>.nfs</code> pool with Ceph's default configuration. If you wish to change the configuration of this pool (for example to change its failure domain or replication factor), you can create a CephBlockPool with the <code>spec.name</code> field set to <code>.nfs</code>. This pool <strong>must</strong> be replicated and <strong>cannot</strong> be erasure coded. <a href=https://github.com/rook/rook/blob/master/deploy/examples/nfs.yaml><code>deploy/examples/nfs.yaml</code></a> contains a sample for reference.</p> <h3 id=adding-custom-nfs-ganesha-config-file-changes>Adding custom NFS-Ganesha config file changes<a class=headerlink href=#adding-custom-nfs-ganesha-config-file-changes title="Permanent link">&para;</a></h3> <p>The NFS-Ganesha config file format for these objects is documented in the <a href=https://github.com/nfs-ganesha/nfs-ganesha/wiki>NFS-Ganesha project</a>.</p> <p>Use Ceph's <code>rados</code> tool from the toolbox to interact with the configuration object. The below command will get you started by dumping the contents of the config object to stdout. The output will look something like the example shown if you have already created two exports as documented above. It is best not to modify any of the export objects created by Ceph so as not to cause errors with Ceph's export management.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-8-1>1</a></span>
<span class=normal><a href=#__codelineno-8-2>2</a></span>
<span class=normal><a href=#__codelineno-8-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1></a><span class=gp>$ </span>rados --pool &lt;pool&gt; --namespace &lt;namespace&gt; get conf-nfs.&lt;cephnfs-name&gt; -
<a id=__codelineno-8-2 name=__codelineno-8-2></a><span class=gp>%</span>url <span class=s2>&quot;rados://&lt;pool&gt;/&lt;namespace&gt;/export-1&quot;</span>
<a id=__codelineno-8-3 name=__codelineno-8-3></a><span class=gp>%</span>url <span class=s2>&quot;rados://&lt;pool&gt;/&lt;namespace&gt;/export-2&quot;</span>
</code></pre></div></td></tr></table></div> <p><code>rados ls</code> and <code>rados put</code> are other commands you will want to work with the other shared configuration objects.</p> <p>Of note, it is possible to pre-populate the NFS configuration and export objects prior to creating CephNFS server clusters.</p> <h2 id=ceph-csi-nfs-provisioner-and-nfs-csi-driver>Ceph CSI NFS provisioner and NFS CSI driver<a class=headerlink href=#ceph-csi-nfs-provisioner-and-nfs-csi-driver title="Permanent link">&para;</a></h2> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>This feature is experimental, and we do not guarantee it is bug-free, nor will we support upgrades to future versions</p> </div> <p>In version 1.9.1, Rook is able to deploy the experimental NFS Ceph CSI driver. This requires Ceph CSI version 3.6.0 or above. We recommend Ceph v16.2.7 or above.</p> <p>For this section, we will refer to Rook's deployment examples in the <a href=https://github.com/rook/rook/tree/master/deploy/examples>deploy/examples</a> directory.</p> <p>The Ceph CSI NFS provisioner and driver require additional RBAC to operate. Apply the <code>deploy/examples/csi/nfs/rbac.yaml</code> manifest to deploy the additional resources.</p> <p>Rook will only deploy the Ceph CSI NFS provisioner and driver components when the <code>ROOK_CSI_ENABLE_NFS</code> config is set to <code>"true"</code> in the <code>rook-ceph-operator-config</code> configmap. Change the value in your manifest, or patch the resource as below.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-9-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1></a><span class=go>kubectl --namespace rook-ceph patch configmap rook-ceph-operator-config --type merge --patch &#39;{&quot;data&quot;:{&quot;ROOK_CSI_ENABLE_NFS&quot;: &quot;true&quot;}}&#39;</span>
</code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The rook-ceph operator Helm chart will deploy the required RBAC and enable the driver components if <code>csi.nfs.enabled</code> is set to <code>true</code>.</p> </div> <p>In order to create NFS exports via the CSI driver, you must first create a CephFilesystem to serve as the underlying storage for the exports, and you must create a CephNFS to run an NFS server that will expose the exports.</p> <p>From the examples, <code>filesystem.yaml</code> creates a CephFilesystem called <code>myfs</code>, and <code>nfs.yaml</code> creates an NFS server called <code>my-nfs</code>.</p> <p>You may need to enable or disable the Ceph orchestrator. Follow the same steps documented <a href=#enable-the-ceph-orchestrator-if-necessary>above</a> based on your Ceph version and desires.</p> <p>You must also create a storage class. Ceph CSI is designed to support any arbitrary Ceph cluster, but we are focused here only on Ceph clusters deployed by Rook. Let's take a look at a portion of the example storage class found at <code>deploy/examples/csi/nfs/storageclass.yaml</code> and break down how the values are determined.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-10-1> 1</a></span>
<span class=normal><a href=#__codelineno-10-2> 2</a></span>
<span class=normal><a href=#__codelineno-10-3> 3</a></span>
<span class=normal><a href=#__codelineno-10-4> 4</a></span>
<span class=normal><a href=#__codelineno-10-5> 5</a></span>
<span class=normal><a href=#__codelineno-10-6> 6</a></span>
<span class=normal><a href=#__codelineno-10-7> 7</a></span>
<span class=normal><a href=#__codelineno-10-8> 8</a></span>
<span class=normal><a href=#__codelineno-10-9> 9</a></span>
<span class=normal><a href=#__codelineno-10-10>10</a></span>
<span class=normal><a href=#__codelineno-10-11>11</a></span>
<span class=normal><a href=#__codelineno-10-12>12</a></span>
<span class=normal><a href=#__codelineno-10-13>13</a></span>
<span class=normal><a href=#__codelineno-10-14>14</a></span>
<span class=normal><a href=#__codelineno-10-15>15</a></span>
<span class=normal><a href=#__codelineno-10-16>16</a></span>
<span class=normal><a href=#__codelineno-10-17>17</a></span>
<span class=normal><a href=#__codelineno-10-18>18</a></span>
<span class=normal><a href=#__codelineno-10-19>19</a></span>
<span class=normal><a href=#__codelineno-10-20>20</a></span>
<span class=normal><a href=#__codelineno-10-21>21</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span><span class=w></span>
<a id=__codelineno-10-2 name=__codelineno-10-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span><span class=w></span>
<a id=__codelineno-10-3 name=__codelineno-10-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-10-4 name=__codelineno-10-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-nfs</span><span class=w></span>
<a id=__codelineno-10-5 name=__codelineno-10-5></a><span class=nt>provisioner</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph.nfs.csi.ceph.com</span><span class=w> </span><span class=c1># [1]</span><span class=w></span>
<a id=__codelineno-10-6 name=__codelineno-10-6></a><span class=nt>parameters</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-10-7 name=__codelineno-10-7></a><span class=w>  </span><span class=nt>nfsCluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-nfs</span><span class=w> </span><span class=c1># [2]</span><span class=w></span>
<a id=__codelineno-10-8 name=__codelineno-10-8></a><span class=w>  </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph-nfs-my-nfs-a</span><span class=w> </span><span class=c1># [3]</span><span class=w></span>
<a id=__codelineno-10-9 name=__codelineno-10-9></a><span class=w>  </span><span class=nt>clusterID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span><span class=w> </span><span class=c1># [4]</span><span class=w></span>
<a id=__codelineno-10-10 name=__codelineno-10-10></a><span class=w>  </span><span class=nt>fsName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myfs</span><span class=w> </span><span class=c1># [5]</span><span class=w></span>
<a id=__codelineno-10-11 name=__codelineno-10-11></a><span class=w>  </span><span class=nt>pool</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myfs-replicated</span><span class=w> </span><span class=c1># [6]</span><span class=w></span>
<a id=__codelineno-10-12 name=__codelineno-10-12></a>
<a id=__codelineno-10-13 name=__codelineno-10-13></a><span class=w>  </span><span class=c1># [7] (entire csi.storage.k8s.io/* section immediately below)</span><span class=w></span>
<a id=__codelineno-10-14 name=__codelineno-10-14></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/provisioner-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-cephfs-provisioner</span><span class=w></span>
<a id=__codelineno-10-15 name=__codelineno-10-15></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/provisioner-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span><span class=w></span>
<a id=__codelineno-10-16 name=__codelineno-10-16></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/controller-expand-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-cephfs-provisioner</span><span class=w></span>
<a id=__codelineno-10-17 name=__codelineno-10-17></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/controller-expand-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span><span class=w></span>
<a id=__codelineno-10-18 name=__codelineno-10-18></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/node-stage-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-cephfs-node</span><span class=w></span>
<a id=__codelineno-10-19 name=__codelineno-10-19></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/node-stage-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span><span class=w></span>
<a id=__codelineno-10-20 name=__codelineno-10-20></a>
<a id=__codelineno-10-21 name=__codelineno-10-21></a><span class=c1># ... some fields omitted ...</span><span class=w></span>
</code></pre></div></td></tr></table></div> <ol> <li><code>provisioner</code>: <strong>rook-ceph</strong>.nfs.csi.ceph.com because <strong>rook-ceph</strong> is the namespace where the CephCluster is installed</li> <li><code>nfsCluster</code>: <strong>my-nfs</strong> because this is the name of the CephNFS</li> <li><code>server</code>: rook-ceph-nfs-<strong>my-nfs</strong>-a because Rook creates this Kubernetes Service for the CephNFS named <strong>my-nfs</strong></li> <li><code>clusterID</code>: <strong>rook-ceph</strong> because this is the namespace where the CephCluster is installed</li> <li><code>fsName</code>: <strong>myfs</strong> because this is the name of the CephFilesystem used to back the NFS exports</li> <li><code>pool</code>: <strong>myfs</strong>-<strong>replicated</strong> because <strong>myfs</strong> is the name of the CephFilesystem defined in <code>fsName</code> and because <strong>replicated</strong> is the name of a data pool defined in the CephFilesystem</li> <li><code>csi.storage.k8s.io/*</code>: note that these values are shared with the Ceph CSI CephFS provisioner</li> </ol> <p>See <code>deploy/examples/csi/nfs/pvc.yaml</code> for an example of how to create a PVC that will create an NFS export. The export will be created and a PV created for the PVC immediately, even without a Pod to mount the PVC. The <code>share</code> parameter set on the resulting PV contains the share path (<code>share</code>) which can be used as the export path when <a href=#mounting-exports>mounting the export manually</a>.</p> <p>See <code>deploy/examples/csi/nfs/pod.yaml</code> for an example of how a PVC can be connected to an application pod.</p> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../ceph-client-crd/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Client CRD" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Client CRD </div> </div> </a> <a href=../../Troubleshooting/ceph-toolbox/ class="md-footer__link md-footer__link--next" aria-label="Next: Toolbox" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Toolbox </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> <a href=/ class=logo> <img src=https://rook.io/images/rook-logo-small.svg alt="rook.io logo"> </a> <p> &#169; Rook Authors 2022. Documentation distributed under <a href=https://creativecommons.org/licenses/by/4.0>CC-BY-4.0</a>. </p> <p> &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage/ >Trademark Usage</a> page. </p> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://slack.rook.io/ target=_blank rel=noopener title=slack.rook.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg> </a> <a href=https://twitter.com/rook_io target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://groups.google.com/forum/#!forum/rook-dev target=_blank rel=noopener title=groups.google.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M191.9 448.6a47.726 47.726 0 0 1-27.78-8.891L32 340.2V480c0 17.62 14.38 32 32 32h256c17.62 0 32-14.38 32-32V340.2l-131.8 99.3a48.4 48.4 0 0 1-28.3 9.1zM192 192c0-35.25 28.75-64 64-64h224V32c0-17.62-14.38-32-32-32H128c-17.6 0-32 14.38-32 32v192h96v-32zm128 64H64c-17.62 0-32 14.4-32 32v12.18l151 113.8c5.25 3.719 12.7 3.734 18.27-.25L352 300.2V288c0-17.6-14.4-32-32-32zm256-96H256c-17.6 0-32 14.4-32 32v32h96c33.25 0 60.63 25.38 63.75 57.88L384 416h192c17.62 0 32-14.38 32-32V192c0-17.6-14.4-32-32-32zm-32 128h-64v-64h64v64z"/></svg> </a> <a href=https://blog.rook.io/ target=_blank rel=noopener title=blog.rook.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M180.5 74.262C80.813 74.262 0 155.633 0 256s80.819 181.738 180.5 181.738S361 356.373 361 256 280.191 74.262 180.5 74.262Zm288.25 10.646c-49.845 0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559c0-94.503-40.4-171.095-90.248-171.095Zm139.506 17.821c-17.526 0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271Z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.tabs.link", "instant", "navigation.expand", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "tabs"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest-release", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.a6c66575.min.js></script> </body> </html>